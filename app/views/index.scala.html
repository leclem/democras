@(message: String, redirectURL: String = "/")(implicit messages: Messages)
@import helper._

<!DOCTYPE html>
<html xmlns:og="http://ogp.me/ns#">
<head>
  <meta charset="utf-8">
  <title>Democras - @Messages("views.subtitle")</title>
<meta property="og:title" content="Democras - @Messages("views.subtitle")" />
<meta property="og:image" content="https://democras.com/assets/images/democras-fb4.png" />

<meta name="twitter:card" content="@Messages("views.democras_descriptionmeta")">
<meta name="twitter:url" content="https://democras.com">
<meta name="twitter:title" content="@Messages("views.subtitle")">
<meta name="twitter:description" content="@Messages("views.democras_descriptionmeta")">
<meta name="twitter:image" content="https://democras.com/assets/images/democras-fb4.png">

<meta name="description" content="@Messages("views.democras_descriptionmeta")" />
    <script src="//code.jquery.com/jquery.min.js"></script>
          <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js"></script>
          <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment-with-locales.min.js"></script>

<meta property="og:url" content="https://democras.com" />
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBLobdMN-hvZIGeTzhlesTeZb22BILOnxo&v=3.exp&signed_in=true&libraries=places"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.14.30/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment-with-locales.min.js"></script>

<meta property="og:description" content="Réseau social de démocratie participative. A l'aide de débats, groupements, et actions de masse, il permet à tout citoyen ou mouvement de se concerter, de se regrouper et d'agir."/>
<meta name="language" content="@messages.lang.language" />
<meta name="google-signin-client_id" content="483427273002-g9hcqk1f8j6p8t03di9f90lfr6kvg0jh.apps.googleusercontent.com.apps.googleusercontent.com">

<link rel="alternate" hreflang="es" href="https://es.democras.com" />
<link rel="alternate" hreflang="en" href="https://en.democras.com" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="@routes.Assets.at("images/favicon.ico")">
  <meta name="google-signin-scope" content="profile email">
  <link href="//cdnjs.cloudflare.com/ajax/libs/octicons/3.1.0/octicons.min.css" rel="stylesheet" type="text/css" />
  <meta name="google-signin-client_id" content="483427273002-g9hcqk1f8j6p8t03di9f90lfr6kvg0jh.apps.googleusercontent.com.apps.googleusercontent.com">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins)-->
  <script src="https://code.jquery.com/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="@routes.Assets.at("javascripts/bootstrap.min.js")"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqBootstrapValidation/1.3.7/jqBootstrapValidation.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.3/handlebars.min.js"></script>
  <link href="@routes.Assets.at("css/bootstrap-social.css")" rel="stylesheet" >
  <link href="@routes.Assets.at("css/font-awesome.css")" rel="stylesheet">
  <link href="@routes.Assets.at("css/pictonic.css")" rel="stylesheet">
  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-75476417-1', 'auto');
  ga('send', 'pageview');
</script>
<script>
<!--FB init Stuff-->

function fbauthentification() {
 FB.login(
  function(response) {
  console.log(response);
 },
 {
  scope: 'public_profile, email',
  auth_type: 'rerequest'
 }
 );
}

window.fbAsyncInit = function() {
    // init the FB JS SDK
    FB.init({
      appId      : '514964885289852',                        // App ID from the app dashboard
      status     : false,                                 // Check Facebook Login status
      xfbml      : true                                  // Look for social plugins on the page
    });

    // *** here is my code ***
    if (typeof facebookInit == 'function') {
        facebookInit();
    }

  };
(function(d){
    var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all.js";
    d.getElementsByTagName('head')[0].appendChild(js);
}(document));

function connectFB(){
  FB.getLoginStatus(function(response) {
     console.log(response.authResponse.accessToken);
     console.log("/connectfb/" + response.authResponse.accessToken + "/%2f")
      window.location = "/connectfb/" + response.authResponse.accessToken + "/%2f";
    });
}

function facebookInit() {
   // Initialisation of the listener
   FB.Event.subscribe('auth.statusChange', function () {
     connectFB();
   });
}
moment.locale('@Messages("views.curLang")');
</script>

  <!-- Bootstrap -->
  <link href="@routes.Assets.at("css/bootstrap.min.css")" rel="stylesheet">
  <link href="@routes.Assets.at("css/index_v2.css")" rel="stylesheet">
  <link href="@routes.Assets.at("css/login_v2.css")" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Maven+Pro:500' rel='stylesheet' type='text/css'><!-- https://github.com/fengyuanchen/cropper -->
  <style>

  #map-canvas {
  height:100%;
    margin: 0;
    padding: 0;
    position: relative;
  }
  .wpmap{
  width:100%;
  height:240px;
  }
  .DemoTitle{
    font-size:5em;margin-bottom:0;
  }
  .DemoSubTitle{
    margin:0;font-size:1.5em;
  }
  @@media (max-width:800px) {
      .presentationPage2 h4{
        font-size: 16px;
      }
      .h2{
        font-size: .8em;
      }
      .presentationPage2 h2{
        font-size: 25px;
      }
      .DemoTitle{
        font-size:4em;margin-bottom:0;
      }
      .DemoSubTitle{
        margin:0;font-size:1em;
      }
  }
  @@media (max-height:500px) {
      .content-wrapper .title{
        margin-top: 0px;
      }
  }
  .output-news{
    overflow-y: scroll;
    overflow-x: hidden;
    height: 400px;
    border: 1px black solid;
    background-color: white;
  }
  </style>
  <!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1863491300568377'); // Insert your pixel ID here.
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1863491300568377&ev=PageView&noscript=1"
/></noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->
  
</head><body>
  <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/fr_FR/sdk.js#xfbml=1&version=v2.7&appId=724251474386860";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
  <!--page principale-->
  <!-- C'est ici que l'on peut mettre la video/ photo -->
    <div id="video-background"></div>
    <!-- <video autoplay loop muted id="video-background">
      <source src="https://secure-c.vimeocdn.com/p/video/yosemite_hd_ii_hd.mp4" type="video/mp4">
    </video> -->
    <!-- <canvas id="canvas"></canvas> -->
    <style>
    a.topbar
{
text-decoration:none;
color:white;
}
    a.topbar:hover
{
text-decoration:none;
color:#18bc9c;
}
</style>
      <div class="container-fluid" style="background-color:#2C3E50; padding:10px">
        <span style="color:white;font-size:2em;"><span class="text-success tevo">D</span>emocras </span>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="topbar" href="/debate">@Messages("views.debates")</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="topbar" href="/action">@Messages("views.actions")</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="topbar" href="/about">@Messages("views.about")</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="topbar" href="https://blog.democras.com">Blog</a>


          @helper.form(action = routes.Connection.processConnectionForm(redirectURL), 'id->"sb_input", 'class->"form-inline pull-right", 'role->"search") {

<a class="btn btn-sm btn-social btn-facebook" onclick="fbauthentification()">
    <span class="fa fa-facebook"></span> @Messages("views.signinfb")
  </a>
              <div class="form-group">
                <input type="text" style="width: 150px; height: 2.3em" class="form-control" name='username' id="username_input" placeholder='@Messages("views.forms.username")'>
              </div>
              <div class="form-group">
                <input type="password" style="width: 150px; height: 2.3em" name="password" class="form-control" id="pass_input" placeholder="@Messages("views.forms.password")">
              </div>
              <input class="btn btn-sm btn-success" id='connect' value="@Messages("views.connect")" type="submit"/>

          <div align="right" class="btn btn-sm btn-success" data-toggle="modal" data-target="#forgot" />@Messages("views.forgotPass")</div><br>


          }
        </div>
        <div class="container-fluid">

      <div class="row">
        <div class="col-xs-12 col-md-3">
        <div class="botwrap">
        <br>
            <div class="title title2" style="color:white;margin-bottom:10px;text-align:center">
            <h2 style="margin-top:0;margin-bottom:0;" class="DemoSubTitle ma">@Messages("views.forms.news")</h2>
          </div>
          <div class="output-news">

          </div>
          </div>

        </div>
        <div class="col-xs-12 col-md-6" style="padding:0;">

          <div class="rightContainer">
           <h4 style="margin-top:10px;" align="center"> @message </h4>

          <div class="title" style="margin-left:15px;margin-right:15px;">
            <h2 class="acenter DemoTitle" style="margin-top:0px;">D<span class="text-success">emocras</span></h2>
            <h2 class="acenter DemoSubTitle"><span class="text-success"></span>@Messages("views.subtitle")<span class="text-success"></span></h2>
            <br>
            <div class="ma" style="text-align:justify;">

              @if(messages.lang == Instantiations.languageFR.lang) {
<div align="center">@Html(Messages("views.democras_presentation"))
<h4><b>@Messages("views.joinourxmembers", Application.getMembersSubcribed())</b></h4></div>
<table width="100%"><tr>
<td width="33%"><div align="center"><h5>Participez à nos nombreux débats</h5></div></td>
<td> <div align="center"><h5>Créez ou rejoignez des actions de groupe</h5></div></td> 
</tr>
<tr><td width="33%"><a href="/debates"><img heigth="100%" width="100%" src="/assets/images/debates_small.png"></a></td><td width="33%">

 
      <div class="wpmap">
        <input id="pac-input" class="controls" type="text" placeholder="Rechercher">
        <div id="map-canvas"></div>
            </div></td>
            </tr>
            </table>
              } else {
                <span class="presentationPage2">
                  <div align="center">@Html(Messages("views.democras_presentation"))
                  <h4><b>@Messages("views.joinourxmembers", Application.getMembersSubcribed())</b></h4></div>
                </span>
              }
            </div>
          </div>

        </div>
        </div>
        <div class="col-xs-12 col-md-3">
        <div class="wrap wrapsub" style="background-color:#2C3E50;margin-top: 0;border-radius: 0px 0px 10px 10px;padding-top: 5px;width:320px;">
            <div class="title title2" style="color:white;margin-bottom:5px;text-align:center">
            <h2 style="margin-top:0;margin-bottom:0;" class="DemoSubTitle ma">@Messages("views.forms.subscription")</h2>
          </div>
            <form id="cmuf" novalidate onsubmit="return false;">
              <div class="control-group">
                <div class="form-group">
                  <input type="email" style="display:inline-block;" class="form-control inputSub" data-validation-required-message="@Messages("views.forms.required")" data-validation-email-message="@Messages("views.forms.notvalidmail")" class="form-control" name='mail' id="smail_input" placeholder='@Messages("views.forms.mail")' required>
                  <p class="help-block" style="color:red;"></p>
                </div>
              </div>
              <div class="control-group">
                <div class="form-group">
                  <input type="text" style="display:inline-block;" class="form-control inputSub" name='username' data-validation-required-message="@Messages("views.forms.required")" id="susername_input" placeholder='@Messages("views.forms.username")' pattern="([0-9A-Za-z\.\-\_])+" data-validation-pattern-message="@Messages("views.forms.notvalid")" required>
                  <a href="#" tabindex="0" data-toggle="popover" data-trigger="focus" data-placement="right" data-content="@Messages("views.help.username")" class="textinfo"><span class="glyphicon glyphicon-info-sign"></span></a>
                  <p class="help-block" style="color:red;"></p>
                </div>
              </div>
              <div class="control-group">
                <div class="form-group">
                  <input type="password" style="display:inline-block;" name="password" data-validation-required-message="@Messages("views.forms.required")" class="form-control inputSub" id="spass_input" placeholder="@Messages("views.forms.password")" required>
                  <a href="#" tabindex="0" data-toggle="popover" data-trigger="focus" data-placement="right" data-content="@Messages("views.help.password")" class="textinfo"><span class="glyphicon glyphicon-info-sign"></span></a>
                  <p class="help-block" style="color:red;"></p>
                </div>
              </div>
              <input type="hidden" value="@Messages("views.curLang")" name="lang"/>
              <div class="form-group" style="text-align:center">
                <span style="font-size:0.7em;color:white">@Html(Messages("views.agreecgu"))</span>
              </div>
              <div class="alert alert-warning" role="alert" id="alertnosubscribe"></div>
              <input class="btn btn-success btn-lg btn-block" id="firstsubscribe" value="@Messages("views.forms.subscription")" type="submit"/>
            </form>
            <div style="text-align:center; color: white;">
          <br><b>@Messages("views.or")</b><br><br>
		  <a class="btn btn-sm btn-social btn-facebook" onclick="fbauthentification()">
    <span class="fa fa-facebook"></span> @Messages("views.signupfb")
  </a>
		  </div>
          </div>
          <br>
        
          
        </div>
      </div>
      </div>
      <footer class="footer">
      <div class="policies container-fluid">
          <span class="cgufooter">
             <a onclick="return !window.open(this.href, 'Terms', 'width=640,height=640')" href="/terms#row_policy">@Messages("views.policy")</a>  | <a onclick="return !window.open(this.href, 'Terms', 'width=640,height=640')" href="/terms">@Messages("views.cgu")</a>  | <a onclick="return !window.open(this.href, 'Terms', 'width=640,height=640')" href="/press">@Messages("views.press")</a>
             <span style="float:right;min-width:295px;">
               <!-- <a class="twitter-follow-button" href="https://twitter.com/Democrascom">Twitter</a> -->
               <div id="fb-root"></div>

             <script>(function(d, s, id) {
               var js, fjs = d.getElementsByTagName(s)[0];
               if (d.getElementById(id)) return;
               js = d.createElement(s); js.id = id;
               js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=724251474386860";
               fjs.parentNode.insertBefore(js, fjs);
             }(document, 'script', 'facebook-jssdk'));</script>
             <a href="https://www.facebook.com/Democras-516339725217427/" target="_blank"> Facebook</a>:
             <div class="fb-like" data-href="https://www.facebook.com/Democras-516339725217427/" data-layout="button" data-action="like" data-show-faces="true" data-share="true"></div>
             <a href="https://twitter.com/democrascom" target="_blank"> Twitter</a>:
             <a href="https://twitter.com/democrascom" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false" data-dnt="true" style="float:left;">Follow @@democrascom</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

             </span>
            <!-- s| <a href="/#">@Messages("views.sponsor")</a> -->
             <span style="float:right;">@Messages("views.forms.lang"): <img onclick="curLang('en')" src="@routes.Assets.at("images/en.jpg")" style="width:16px;cursor:pointer;" />&nbsp;|&nbsp;
              <img onclick="curLang('es')" src="@routes.Assets.at("images/es.jpg")" style="width:16px;cursor:pointer;" />&nbsp;|&nbsp;
              <img onclick="curLang('fr')" src="@routes.Assets.at("images/fr.jpg")" style="width:16px;cursor:pointer;" />&nbsp;|&nbsp;
            </span>
           </span>
    </div>
  </footer>
<script>
var isIe = (/MSIE/i.test(navigator.userAgent)) || (/Trident.*rv\:11\./i.test(navigator.userAgent));
function is_touch_device() {
  return 'ontouchstart' in window
      || navigator.maxTouchPoints;
};
if(window.innerWidth < 800 ||isIe){
  location.href = "/mobile";
}
var iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
if(iOS){
  //$('div.content-wrapper').addClass('ipadding');
}
//searchAll/:maxTimestamp/:number
$.ajax({
  url: '/searchAll/-1/35',
  type: 'get',
  dataType: 'JSON',
  success: function(data, status) {
    console.log(data);
    console.log(434132431243214431241243);
    $('.loagif').hide();
    data.forEach(function(item){
        switch (item.typeEntry) {
          case "concept":
            item.octicon = "law";
            item.typeName = "@Messages("views.concepts")";
            break;
          case "group":
            item.octicon = "organization";
            item.typeName = "@Messages("views.groups")";
            break;
          case "debate":
            item.octicon = "megaphone";
            item.typeName = "@Messages("views.debates")";
            break;
          case "action":
            item.octicon = "location";
            item.typeName = "@Messages("views.actions")";
            break;
          case "petition":
            item.octicon = "book";
            item.typeName = "@Messages("views.petitions")";
            break;
          default:
            item.octicon = "book";
            item.typeName = "@Messages("views.petitions")";
            break;
        }

    });
    console.log(data);
     var item = {'response' : data};
     var source   = $('#news-template').html();
     var template = Handlebars.compile(source);
     $('.output-news').append(template(item));
  }});
$('.textinfo').popover();
$('#username_input').focus();
function curLang(plang){
  if(plang=="fr"){
    $.get("/changelang/fr",function(data){
      location.reload();
    })
  }else if(plang=="es"){
    $.get("/changelang/es",function(data){
      location.reload();
    })
  }else{
    $.get("/changelang/en",function(data){
      location.reload();
    });
  }
}
$('form#cmuf input').jqBootstrapValidation(
  {
    submitSuccess: function ($form, event) {
      createmUser();
    }
  }
);
$('#alertnosubscribe').hide();
function createmUser(){
  $('#firstsubscribe').prop('disabled',true);
  $.ajax({url:'/firstsubscribe',type:'post',data:$('#cmuf').serialize(),success:function(data){
    if(data == 1){
      $('#username_input').val($('#susername_input').val());
      $('#pass_input').val($('#spass_input').val());
      $('#connect').click();
    }else if (data == 1) {
      $('#alertnosubscribe').text('@Messages("views.nosubscribe.mail")').show('slideup');
    }else if (data == 2) {
      $('#alertnosubscribe').text('@Messages("views.nosubscribe.user")').show('slideup');
    }else {
      $('#alertnosubscribe').text('@Messages("views.nosubscribe.error")').show('slideup');
    }
    if(data != 1){$('#firstsubscribe').prop('disabled',false);}
  }});
}
</script>
<!-- <script src="@routes.Assets.at("javascripts/bubbles.js")"></script> -->
<script>
var dev =0;
function debugit(ptar){
  if(dev==1){
    console.log(ptar);
  }
}
</script>
<script>
function forgotPass(event){
  if($.trim($('#newPassUser'))!=''){
    $(event.target).button('loading');
    $.ajax({url:'/forget',type:'post',data:{username:$.trim($('#newPassUser').val())},success:function(data){
      if(data==1){
        $(event.target).parents('.modal-body').empty().append('<p class="acenter">@Messages("views.successForget")</p>');
      }else {
        $(event.target).button('reset');
      }
    }});
  }
}
function forgetPassEnter(e){
  if (e.keyCode == 13) {
    $('#forgetPassBtn').click();
  }
}
</script>
<script id="news-template" type="text/x-handlebars-template">
    {{#each response}}
        <div class="row" style="margin:3px;">
          <div class="col-xs-12 searchlist" style="padding:0;">
            <div class="mbox fmbox" style="min-height: 60px;">
              <span class="mega-octicon octicon-{{octicon}} searchfst"></span>
              <div class="mboxin" >
                  <!-- <a class="author_name np" href="/{{typeEntry}}/{{id}}"> {{info}}</a> -->


                <div class="mboxh"><span class="label label-primary">{{typeName}}</span> <a href='/{{typeEntry}}/{{id}}' style="font-weight: bold;">{{{name}}}</a>

                </div>
                <!-- <div class="mboxb"><span style="word-wrap:break-word;">{{{info}}}</span> -->
                </div>
                <div class="mboxf mbinctime">
                  <input type="hidden" class="pmT" value="{{updatedTimestamp}}"/>
                </div>
              </div>
            </div>
          </div>
        </div>
    {{/each}}
  </script>
  <script>
if($.trim($('#atmess').text())==""){
  $('.atmess').hide();
}
// google.maps.event.trigger(map, 'resize');
// map.setZoom( map.getZoom() );
google.maps.event.addDomListener(window, 'load', initialize);
// This example adds a search box to a map, using the Google Place Autocomplete
// feature. People can enter geographical searches. The search box will return a
// pick list containing a mix of places and predicted search terms.
//mulolalojo
var mpos= [];
var map;
var markers = [];
function initialize() {



  map = new google.maps.Map(document.getElementById('map-canvas'), {
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    zoom:6,
    center: {lat: 48.8566, lng: 2.3522},
  });
//
// if (navigator.geolocation) {
//      navigator.geolocation.getCurrentPosition(function (position) {
//          initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
//          map.setCenter(initialLocation);
//      });
//  }
  // var defaultBounds = new google.maps.LatLngBounds(
  //   new google.maps.LatLng(48.831502171737235, 2.409179087109351),
  // new google.maps.LatLng(48.87668198781442, 2.285582895703101));
  //   map.fitBounds(defaultBounds);

  // Create the search box and link it to the UI element.
  var input = (document.getElementById('pac-input'));
  map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

  var searchBox = new google.maps.places.SearchBox((input));

  // [START region_getplaces]
  // Listen for the event fired when the user selects an item from the
  // pick list. Retrieve the matching places for that item.
  google.maps.event.addListener(searchBox, 'places_changed', function() {
    var places = searchBox.getPlaces();

    if (places.length == 0) {
      return;
    }
    for (var i = 0, marker; marker = markers[i]; i++) {
      marker.setMap(null);
    }

    // For each place, get the icon, place name, and location.
    markers = [];
    var bounds = new google.maps.LatLngBounds();
    for (var i = 0, place; place = places[i]; i++) {
      var image = {
        url: place.icon,
        size: new google.maps.Size(71, 71),
        origin: new google.maps.Point(0, 0),
        anchor: new google.maps.Point(17, 34),
        scaledSize: new google.maps.Size(25, 25)
      };

      // Create a marker for each place.
      var marker = new google.maps.Marker({
        map: map,
        icon: image,
        title: place.name,
        position: place.geometry.location
      });

      markers.push(marker);
      //debugit(marker.getPlace("placeId"));
      mpos = {lat: marker.getPosition().lat(), lng: marker.getPosition().lng(), title: marker.title};
      //gmark(marker.getPosition().lat(),marker.getPosition().lng());
      bounds.extend(place.geometry.location);
    }

    map.fitBounds(bounds);
  });
  // [END region_getplaces]

  // Bias the SearchBox results towards places that are within the bounds of the
  // current map's viewport.
  google.maps.event.addListener(map, 'bounds_changed', function() {
    var bounds = map.getBounds();
    searchBox.setBounds(bounds);
    getMarkers();
  });
  // map.addListener('dragend', function(e) {
  //   console.log(map.getBounds());
  // });
  // map.addListener('zoom_changed', function(e) {
  //   console.log(map.getBounds());
  // });

}//end initialize
//gmark();
var fulltitle='';
function gmark(px,py){
  $.get('https://maps.googleapis.com/maps/api/geocode/json?latlng='+px+','+py,function(data){
    fulltitle=data.results[0].formatted_address;
  });
  /*
  var geocoder = new google.maps.Geocoder();
  geocoder.geocode( { 'latlng': '48.856614,2.3522219' }, function(results, status) {
  if (status == google.maps.GeocoderStatus.OK) {
  debugit(results);
  debugit(results.formatted_address);
}
});*/
}
function nSearch(){
  for (var i = 0, marker; marker = markers[i]; i++) {
    marker.setMap(null);
  }
}
var infoWindows = [];
var infoMarkers = [];
function getMarkers(){
var pboundsNE = map.getBounds().getNorthEast();//.lat() or .lng() then
var pboundsSW = map.getBounds().getSouthWest();
$.ajax({
  url: '/action/json/getActions/'+moment.utc().valueOf()+'/9999999999999/'+pboundsSW.lat()+'/'+pboundsNE.lat()+'/'+pboundsSW.lng()+'/'+pboundsNE.lng()+'/25',
  type: 'get',
  dataType: 'JSON',
  success: function(data, status) {
    if(data.moreAvailable){
      $('#v1').show();
    }else {
      $('#v1').hide();
    }
    data.actions.forEach(function(item){
      for(var i=0; i < infoMarkers.length; i++){
        if(infoMarkers[i].id==item.id){
          return;
        }
      }
      infoMarkers.push(item);
      var marker = new google.maps.Marker({
        map: map,
        title: item.name,
        position: {lat: item.latitude, lng: item.longitude},
        animation: google.maps.Animation.DROP
      });
      var infoDates;
      item.timeBegin = moment.utc(item.timeBegin).format('LLL');
      if(item.timeEnd == -1){infoDates = '@Messages("views.action.startT"): '+item.timeBegin;}else{
        item.timeEnd = moment.utc(item.timeEnd).format('LLL');infoDates = '@Messages("views.action.startT"): '+item.timeBegin +'<br>@Messages("views.action.endT"): '+ item.timeEnd;
      }
      var infowindow = new google.maps.InfoWindow({
        content: '<div><a href="/action/'+item.id+'">'+item.name+'</a><br/><strong>'+infoDates+'</strong><br/>'+item.definition+'</div>'
      });
      infoWindows.push(infowindow);
      marker.addListener('click', function() {
        infoWindows.forEach(function(item){
          if (item)
          {
            item.close();
          }
        });
        infowindow.open(map, marker);
      });
      markers.push(marker);
    });
  }});
}
function mapEvent(e){
  console.log(e);
}

///////http://codepen.io/bradfrost/pen/tLxAs
function getpos(){
  debugit(mpos);
  debugit(fulltitle);
  $('#titlepos').val(mpos.title);
  $('#latpos').val(mpos.lat);
  $('#lngpos').val(mpos.lng);
  $('#createabtn').prop('disabled',false);
  if(isend == 0){pendt = -1;}else{$('#verifend').html('<b>@Messages("views.action.endT"):</b> '+$.trim($("#dEnd").val())+'<br/>');}
  $('#verifname').text($.trim($('#naname').val()));
  $('#verifdescription').text($.trim($('#nadefinition').val()));
  $('#verifstart').text($.trim($("#dStart").val()));
  $('#verifaddress').text(fulltitle);
  $('#veriflocation').text(mpos.title);
  $("#verifa").attr('href',"http://www.google.com/maps/place/"+mpos.lat+","+mpos.lng);
  $("#verifi").attr('src',"http://maps.google.com/maps/api/staticmap?center="+mpos.lat+","+mpos.lng+"&zoom=16&markers="+mpos.lat+","+mpos.lng+"&size=640x320&sensor=true");
}

</script>
<div class="modal fade" id="forgot" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header pheadermdl">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h2 class="acenter">@Messages("views.forgotPass")</h2>
      </div>
      <div class="modal-body">
        <p class="acenter">@Messages("views.forgotPassMess")</p>
        <input type="text" class="form-control" id="newPassUser" value="" placeholder="@Messages("views.forms.username")" onkeypress="forgetPassEnter(event)"/>
        <div class="mt5" style="height:40px">
          <button type="button" name="button" class="btn btn-success btn-block pc" data-loading-text="@Messages("views.loading")" onclick="forgotPass(event)" id="forgetPassBtn">@Messages("views.send")</button>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
